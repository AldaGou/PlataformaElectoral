<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="icon" type="image/png" href="favicon.png">
  <title>SISTEMA DE VOTACIÓN ELECTRÓNICA</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: Arial, sans-serif;
      background-color: #f0f0f0;
      padding: 20px;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .cedula-container {
      background: white;
      width: 600px;
      max-width: 95vw;
      border: 3px solid #000;
      box-shadow: 0 0 20px rgba(0,0,0,0.3);
      position: relative;
    }

    /* Distrito */
    .distrito-header {
      background: #000;
      color: white;
      text-align: center;
      padding: 10px;
      font-weight: bold;
      font-size: 16px;
    }

    /* Instrucciones */
    .instructions {
      background: #d0d0d0;
      padding: 8px 15px;
      text-align: center;
      font-size: 12px;
      font-weight: bold;
    }

    /* Secciones */
    .section {
      padding: 20px;
      display: none;
    }

    .section.active {
      display: block;
    }

    /* Formularios */
    .form-group {
      margin-bottom: 15px;
    }

    .form-group label {
      display: block;
      font-weight: bold;
      margin-bottom: 5px;
      font-size: 14px;
    }

    .form-group input {
      width: 100%;
      padding: 8px;
      border: 2px solid #000;
      font-size: 14px;
    }

    .btn-primary,
.btn-secondary {
  background: #333;
  color: white;
  padding: 12px 30px;
  border: none;
  font-size: 14px;
  font-weight: bold;
  cursor: pointer;
  width: 100%;
  margin-top: 10px;
  text-align: center;
}

.btn-primary:hover,
.btn-secondary:hover {
  background: #000;
}

    /* Datos del votante */
    .voter-info {
      background: #fff; /* mismo fondo que la página */
      border: 2px solid #000; /* mismo borde que la bandera y los cuadros */
      padding: 15px 20px;
      margin: 15px 0;
      border-radius: 8px;
      font-family: Arial, sans-serif; /* igual que la web */
      box-shadow: 2px 2px 6px rgba(0, 0, 0, 0.1); /* igual que los títulos */
    }

    .voter-info h3 {
      margin-bottom: 12px;
      font-size: 18px;
      color: #000; /* para que combine con el título */
      font-weight: bold;
      border-bottom: 2px solid #000; /* línea como en la cartilla */
      padding-bottom: 5px;
    }

    .voter-info p {
      margin: 8px 0;
      font-size: 15px;
      color: #333; /* un poco más suave que negro */
    }

    .voter-info strong {
      color: #000;
      font-weight: bold;
    }

    /* Lista de candidatos */
    .candidate-item {
      display: flex;
      align-items: center;
      background: #e6f3ff;
      border: 2px solid #000;
      margin-bottom: 2px;
      padding: 15px;
      cursor: pointer;
      transition: all 0.2s;
      position: relative;
    }

    .candidate-item:hover {
      background: #cce7ff;
    }

    .candidate-item.selected {
      background: #b3d9ff;
      border-color: #0066cc;
    }

    .candidate-name {
      flex: 1;
      font-weight: bold;
      font-size: 14px;
      padding-left: 10px;
    }

    .candidate-symbol {
      width: 50px;
      height: 50px;
      border: 1px solid #000;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      margin-right: 15px;
      background: white;
      position: relative;
    }

    /* Marca X */
    .vote-mark {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 35px;
      color: #e53e3e;
      font-weight: bold;
      display: none;
      z-index: 10;
      text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
    }

    .candidate-item.selected .vote-mark {
      display: block;
    }

    /* Botón votar */
    .btn-votar {
      background: #228B22;
      color: white;
      padding: 15px 30px;
      border: none;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
      width: 100%;
      margin-top: 20px;
      display: none;
    }

    .btn-votar.show {
      display: block;
    }

    .btn-votar:hover {
      background: #006400;
    }

    .error-message {
      color: #e53e3e;
      font-size: 12px;
      margin-top: 5px;
      display: none;
    }

    .success-message {
      color: #28a745;
      font-size: 14px;
      text-align: center;
      margin: 10px 0;
    }

    .loading {
      text-align: center;
      padding: 20px;
      display: none;
    }

    /* Responsive */
    @media (max-width: 700px) {
      .main-header {
        flex-direction: column;
        text-align: center;
      }

      .logo-left, .logo-onpe {
        margin: 5px 0;
      }

      .cedula-container {
        width: 100%;
      }
    }

    /* Footer de créditos */
    .footer-credits {
      background: #f8f9fa;
      border-top: 1px solid #e9ecef;
      padding: 15px;
      text-align: center;
      font-size: 12px;
      color: #6c757d;
      margin-top: 20px;
    }

    .footer-credits a {
      color: #007bff;
      text-decoration: none;
    }

    .footer-credits a:hover {
      text-decoration: underline;
    }

    .credits-line {
      margin: 3px 0;
    }
  </style>
</head>
<body>
  <div class="cedula-container">
    <!-- Header principal -->
    

    <!-- Distrito -->
    <div class="distrito-header">
      SISTEMA DE VOTACIÓN ELECTRÓNICA
    </div>

    <!-- Instrucciones -->
    <div class="instructions">
      UNIDADES DE ILO Y CAJUNA
    </div>

    <!-- Sección 1: Ingreso de DNI -->
    <div id="dni-section" class="section active">
      <h3 style="text-align: center; margin-bottom: 20px;">VERIFICACIÓN DE VOTANTE</h3>
      <div class="form-group">
        <label for="dni">Número de DNI:</label>
        <input type="number" id="dni" required maxlength="8" placeholder="Ingrese su DNI de 8 dígitos">
        <div class="error-message" id="error-dni">DNI no válido o no autorizado para votar</div>
      </div>
      <div style="display: flex; justify-content: center;">
  <button class="btn-primary" onclick="verificarDNI()">VERIFICAR VOTANTE</button>
</div>
<div id="mensaje-cargando" style="display: none; color: #555; margin-top: 10px;">Espere, validando...</div>
    </div>

    <!-- Sección 2: Confirmación de datos -->
    <div id="confirmation-section" class="section">
      <h3 style="text-align: center; margin-bottom: 20px;">CONFIRME SUS DATOS</h3>
      <div class="voter-info" id="voter-info">
        <!-- Los datos se llenarán dinámicamente -->
      </div>
      <p style="text-align: center; margin: 15px 0; font-weight: bold;">
        ¿Son correctos sus datos?
      </p>
      <div style="display: flex; gap: 16px; margin-top: 15px;">
  <button class="btn-primary" onclick="confirmarDatos()" style="flex: 1;">SÍ, ES CORRECTO</button>
  <button class="btn-secondary" onclick="volverDNI()" style="flex: 1;">NO, VERIFICAR OTRA VEZ</button>
</div>
    </div>

    <!-- Sección 3: Lista de candidatos -->
<div id="candidates-section" class="section">
  <div class="instructions" style="background: #d0d0d0; margin: -20px -20px 20px -20px; padding: 8px 15px;">
    Selecciona una opción y haz clic en "EMITIR VOTO" para continuar.
  </div>

  <div class="candidate-item" onclick="seleccionarCandidato(this, 'UNIDAD SINDICAL')">
    <div class="candidate-symbol">
      ⬜
      <div class="vote-mark">✗</div>
    </div>
    <div class="candidate-name">UNIDAD SINDICAL</div>
  </div>

  <div class="candidate-item" onclick="seleccionarCandidato(this, 'VOTO EN BLANCO')">
    <div class="candidate-symbol" style="background: #f0f0f0;">
      ⬜
      <div class="vote-mark">✗</div>
    </div>
    <div class="candidate-name">VOTO EN BLANCO</div>
  </div>

  <button id="btn-votar" class="btn-votar" onclick="enviarVoto()">EMITIR VOTO</button>
</div>

    <!-- Loading -->
    <div id="loading" class="loading">
      <strong>Procesando su voto...</strong>
    </div>

    <!-- Footer de créditos -->
    <div class="footer-credits">
      <div class="credits-line">
        <strong>Sistema Electoral Digital</strong>
      </div>
      <div class="credits-line">
        Diseñado y desarrollado por <strong>Aldair Ramos</strong>
      </div>
      <div class="credits-line">
        © 2025 - Todos los derechos reservados
      </div>
      <div class="credits-line">
        <a href="aldair.ramosmayta@email.com">Contacto</a> | 
        <a href="#" onclick="alert('Sistema v2.0')">Versión 2.0</a>
      </div>
    </div>
  </div>

  <script>
    // Configuración de SheetDB
    const SHEETDB_URL = 'https://sheetdb.io/api/v1/9816xrzrwjf2c';
    let votanteActual = null;
    let candidatoSeleccionado = null;

    // Base de datos de votantes autorizados
    const votantesAutorizados = [
  {'dni': '08208650', 'nombre': 'ARROYO ESPINOZA RONALD', 'registro': '21860', 'gerencia': 'MANTENIMIENTO MINA', 'cargo': 'EMPLEADO', 'unidad': 'ILO'},
  {'dni': '04646546', 'nombre': 'LOPEZ GUTIERREZ ALFREDO FELIPE', 'registro': '92258', 'gerencia': 'OPERACIONES', 'cargo': 'ESPECIALISTA DE SALA DE CONTROL', 'unidad': 'ILO'},
  {'dni': '04645810', 'nombre': 'LOZANO LUNA LANDER RAFAEL', 'registro': '92867', 'gerencia': 'FUNDICION', 'cargo': 'OPERADOR DE SALA', 'unidad': 'ILO'},
  {'dni': '72346349', 'nombre': 'CALAHUILLE CONDORI WUIDO', 'registro': '92441', 'gerencia': 'FUNDICION', 'cargo': 'OPERADOR', 'unidad': 'ILO'},
  {'dni': '42708440', 'nombre': 'BELLOTA RAMOS DENNIS PIERRE', 'registro': '100146', 'gerencia': 'FUNDICION', 'cargo': 'OPERADOR DE SALA', 'unidad': 'ILO'},
  {'dni': '29557385', 'nombre': 'HERRERA LIZMA JHON MARTI', 'registro': '21860', 'gerencia': 'OPERACIONES', 'cargo': 'OPERADOR DE SALA', 'unidad': 'ILO'},
  {'dni': '43810512', 'nombre': 'ALCANTARA CORNEJO ANDY WILLIAMS', 'registro': '94249', 'gerencia': 'MANTENIMIENTO', 'cargo': 'MECANICO', 'unidad': 'ILO'},
  {'dni': '42232978', 'nombre': 'HERRERA CONDORI LENIN JONAS', 'registro': '97286', 'gerencia': 'CONVERTIDORES', 'cargo': 'ELECTRICISTA', 'unidad': 'ILO'},
  {'dni': '45448691', 'nombre': 'BENITES GRANDA JOEL ALBERTO', 'registro': '100682', 'gerencia': 'MANTENIMIENTO', 'cargo': 'OPERADOR', 'unidad': 'ILO'},
  {'dni': '45043070', 'nombre': 'PINTO VALDIVIA ALBERTO YSAAC', 'registro': '94030', 'gerencia': 'FUNDICION', 'cargo': 'OPERADOR DE PLANTA', 'unidad': 'ILO'},
  {'dni': '44809350', 'nombre': 'BELLOTA RAMOS DENNIS PIERRE', 'registro': '100680', 'gerencia': 'FERROCARRIL INDUSTRIAL', 'cargo': 'OPERADOR', 'unidad': 'ILO'},
  {'dni': '04426289', 'nombre': 'PINTO ESQUICHE MICHAEL LUIS', 'registro': '95845', 'gerencia': 'MANTENIMIENTO', 'cargo': 'TECNICO ALMACENES', 'unidad': 'ILO'},
  {'dni': '43672073', 'nombre': 'QUINTANILLA QUISPE MARCO ANTONIO', 'registro': '93330', 'gerencia': 'ABASTECIMIENTO', 'cargo': 'OPERADOR', 'unidad': 'ILO'},
  {'dni': '04438250', 'nombre': 'AROCUTIPA CENTELLAS JESUS RENE', 'registro': '96523', 'gerencia': 'HOSPITAL', 'cargo': 'TECNOLOGO MEDICO', 'unidad': 'CUAJONE'},
  {'dni': '09522707', 'nombre': 'ROMERO CALIZAYA JUAN ALBERTO', 'registro': '91037', 'gerencia': 'HOSPITAL', 'cargo': 'ENFERMERA', 'unidad': 'CUAJONE'},
  {'dni': '04427732', 'nombre': 'SAIRA MAITA ZENON ABEL', 'registro': '96844', 'gerencia': 'CUAJONE', 'cargo': 'OPERADOR DE SALA', 'unidad': 'CUAJONE'},
  {'dni': '29712285', 'nombre': 'SILVA BELTRAN ANGEL EDUARDO', 'registro': '95339', 'gerencia': 'OPERACIONES MINA', 'cargo': 'OPERADOR', 'unidad': 'CUAJONE'},
  {'dni': '04749426', 'nombre': 'CALIZAYA RAMOS WILBER ALI', 'registro': '92216', 'gerencia': 'OPERACIONES MINA', 'cargo': 'OPERADOR DE SALA', 'unidad': 'CUAJONE'},
  {'dni': '04645182', 'nombre': 'CCAPIRA YANQUE ELIAS', 'registro': '91919', 'gerencia': 'RR.HH.', 'cargo': 'ESPECIALISTA', 'unidad': 'CUAJONE'},
  {'dni': '04642819', 'nombre': 'PALACIOS TORRES ALBERTH', 'registro': '93261', 'gerencia': 'CONVERTIDORES', 'cargo': 'OPERADOR', 'unidad': 'CUAJONE'},
  {'dni': '40504322', 'nombre': 'CERVANTES ZAPATA GABRIEL ANGEL', 'registro': '100692', 'gerencia': 'RR.HH.', 'cargo': 'OPERADOR DE SALA', 'unidad': 'CUAJONE'},
  {'dni': '04427444', 'nombre': 'SANCHEZ CARVALLO ALFREDO WILFREDO', 'registro': '92205', 'gerencia': 'MANTENIMIENTO', 'cargo': 'OPERADOR', 'unidad': 'CUAJONE'},
  {'dni': '40734192', 'nombre': 'NUÑEZ NUÑEZ ROY BARDO', 'registro': '92865', 'gerencia': 'MANTENIMIENTO', 'cargo': 'MECANICO SOLDADOR', 'unidad': 'CUAJONE'},
  {'dni': '29557385', 'nombre': 'LUIS CUAYLA JHON RICHAR', 'registro': '91642', 'gerencia': 'MANTENIMIENTO MINA', 'cargo': 'OPERADOR', 'unidad': 'CUAJONE'},
  {'dni': '80159836', 'nombre': 'ORTEGA RAMOS SAMUEL EDGAR', 'registro': '92947', 'gerencia': 'MANTENIMIENTO', 'cargo': 'SOLDADOR', 'unidad': 'CUAJONE'},
  {'dni': '40994154', 'nombre': 'VILCA QUISPE ALBERTO', 'registro': '91014', 'gerencia': 'OPERACIONES MINA', 'cargo': 'EMPLEADO OPERADOR', 'unidad': 'CUAJONE'},
  {'dni': '43460419', 'nombre': 'SILVA CONDIRI ALI DAVID', 'registro': '98616', 'gerencia': 'CONVERTIDORES', 'cargo': 'OPERADOR', 'unidad': 'CUAJONE'},
  {'dni': '43821308', 'nombre': 'ZACONETT SILVA VICTOR EDUARDO', 'registro': '10732', 'gerencia': 'OPERACIONES MINA', 'cargo': 'OPERADOR DE SALA', 'unidad': 'CUAJONE'},
  {'dni': '45985336', 'nombre': 'HUMIRE SALINAS LORENZO FELIX', 'registro': '97687', 'gerencia': 'MANTENIMIENTO MINA', 'cargo': 'OPERADOR', 'unidad': 'CUAJONE'},
  {'dni': '04417155', 'nombre': 'ZAVALAGA RUIZ VICTOR PAUL', 'registro': '93716', 'gerencia': 'CONVERTIDORES', 'cargo': 'OPERADOR', 'unidad': 'CUAJONE'},
  {'dni': '30643154', 'nombre': 'VALDIVIA MANCHEGO ZENON EDIL', 'registro': '93732', 'gerencia': 'CONVERTIDORES', 'cargo': 'OPERADOR', 'unidad': 'CUAJONE'},
  {'dni': '29575067', 'nombre': 'ANICAMA ESPINO PEDRO MANUEL MARTIN', 'registro': '94375', 'gerencia': 'CONVERTIDORES', 'cargo': 'OPERADOR', 'unidad': 'CUAJONE'},
  {'dni': '70498716', 'nombre': 'VILCAPAZA TIPO RAUL PAULINO', 'registro': '10581', 'gerencia': '', 'cargo': 'OPERADOR DE SALA', 'unidad': 'CUAJONE'},
  {'dni': '41777509', 'nombre': 'GUTIERREZ GOMEZ ROLANDO', 'registro': '99863', 'gerencia': 'CONVERTIDORES', 'cargo': 'SOLDADOR', 'unidad': 'CUAJONE'},
  {'dni': '40363313', 'nombre': 'GARCIA AVILES RICHAR LUCIO', 'registro': '92231', 'gerencia': 'OPERACIONES MINA', 'cargo': 'OPERADOR DE SALA', 'unidad': 'CUAJONE'},
  {'dni': '43672422', 'nombre': 'CALDERON CHUMA CRISTIAN EDUARDO', 'registro': '94545', 'gerencia': 'CONVERTIDORES', 'cargo': 'OPERADOR', 'unidad': 'CUAJONE'},
  {'dni': '10743859', 'nombre': 'PRUDENCIO SANCHEZ YONY', 'registro': '92549', 'gerencia': 'RR.HH.', 'cargo': 'OPERADOR DE SALA', 'unidad': 'CUAJONE'},
  {'dni': '29660438', 'nombre': 'MOLLO RODRIGUEZ JOSE ANTONIO', 'registro': '94687', 'gerencia': 'CONVERTIDORES', 'cargo': 'OPERADOR', 'unidad': 'CUAJONE'},
  {'dni': '40059511', 'nombre': 'GRUNDY GRUNDY ALFREDO ELIAS', 'registro': '93347', 'gerencia': 'CONVERTIDORES', 'cargo': 'TEC. ELECTRICISTA', 'unidad': 'CUAJONE'},
  {'dni': '04642856', 'nombre': 'MAMANI JUAN HUGO', 'registro': '93709', 'gerencia': 'CONVERTIDORES', 'cargo': 'OPERADOR', 'unidad': 'CUAJONE'},
  {'dni': '04642075', 'nombre': 'PANCA ROQUE JOSE LUIS', 'registro': '92218', 'gerencia': 'CONVERTIDORES', 'cargo': 'TEC. ELECTRICISTA', 'unidad': 'CUAJONE'},
  {'dni': '04749943', 'nombre': 'CHOQUEGONZA CHOQUEGONZA WILBERT DANIEL', 'registro': '94834', 'gerencia': 'MANTENIMIENTO MINA', 'cargo': 'SOLDADOR', 'unidad': 'CUAJONE'},
  {'dni': '43533128', 'nombre': 'VALDEIGLESIAS HUANCCO ISAIAS', 'registro': '94900', 'gerencia': 'OPERACIONES MINA', 'cargo': 'OPERADOR MULTIPLE', 'unidad': 'CUAJONE'},
  {'dni': '41328423', 'nombre': 'MARTINEZ CRESPO ADOLFO ISRAEL', 'registro': '96337', 'gerencia': 'CONVERTIDORES', 'cargo': 'TEC. ELECTRICISTA', 'unidad': 'CUAJONE'},
  {'dni': '04642783', 'nombre': 'MUJICA CASTRO ANTONIO', 'registro': '95492', 'gerencia': 'MANTENIMIENTO MINA', 'cargo': 'OPERADOR', 'unidad': 'CUAJONE'},
  {'dni': '46723898', 'nombre': 'CARRILLO TEJADA ROGER DIOGENES', 'registro': '96920', 'gerencia': 'CONVERTIDORES', 'cargo': 'MECANICO', 'unidad': 'CUAJONE'},
  {'dni': '43460419', 'nombre': 'SARAYASI VILCA RAUL ERNESTO', 'registro': '98556', 'gerencia': 'HOSPITAL', 'cargo': 'ESPECIALISTA ELECTROMEDICO', 'unidad': 'CUAJONE'},
  {'dni': '29719214', 'nombre': 'VALERIO ROJAS VICTOR GIANCARLO', 'registro': '96630', 'gerencia': 'CONVERTIDORES', 'cargo': 'MECANICO', 'unidad': 'CUAJONE'},
  {'dni': '04651000', 'nombre': 'VICENTE JIMENEZ JUAN CARLOS', 'registro': '93785', 'gerencia': 'CONVERTIDORES', 'cargo': 'TECNICO MECANICO', 'unidad': 'CUAJONE'},
  {'dni': '40588357', 'nombre': 'CRUZ SORIANO MARIA HAYDEE', 'registro': '99001', 'gerencia': 'CPS', 'cargo': 'ESPECIALISTA', 'unidad': 'CUAJONE'}
];

  // NUEVAS 3 PERSONAS AÑADIDAS:
  {'dni': '12345678', 'nombre': 'RODRIGUEZ MAMANI CARLOS ALBERTO', 'registro': '99100', 'gerencia': 'PRUEBA', 'cargo': 'PRUEBA', 'unidad': 'PRUEBA'},
  {'dni': '87654321', 'nombre': 'QUISPE FLORES MARIA ELENA', 'registro': '99101', 'gerencia': 'PRUEBA', 'cargo': 'PRUEBA', 'unidad': 'PRUEBA'},
  {'dni': '11223344', 'nombre': 'CONDORI SILVA JUAN FERNANDO', 'registro': '99102', 'gerencia': 'PRUEBA', 'cargo': 'PRUEBA', 'unidad': 'PRUEBA'}
    
    function verificarDNI() {
  const dni = document.getElementById('dni').value.trim();
  const errorElement = document.getElementById('error-dni');
  const mensajeCargando = document.getElementById('mensaje-cargando');
  
  // Limpiar mensajes previos
  errorElement.style.display = 'none';
  mensajeCargando.style.display = 'none';

  if (!dni || dni.length !== 8) {
    errorElement.textContent = 'El DNI debe tener exactamente 8 dígitos';
    errorElement.style.display = 'block';
    return;
  }

  // Mostrar mensaje de carga
  mensajeCargando.style.display = 'block';

  // Simular pequeña demora para mostrar el mensaje (opcional)
  setTimeout(() => {
    const votante = votantesAutorizados.find(v => v.dni === dni);
    
    mensajeCargando.style.display = 'none'; // Ocultar mensaje de carga

    if (!votante) {
      errorElement.textContent = 'DNI no autorizado para votar en esta elección';
      errorElement.style.display = 'block';
      return;
    }

    // Verificar si ya votó
    verificarSiYaVoto(dni, votante);
  }, 2000); // puedes ajustar este tiempo si lo deseas
}


    function verificarSiYaVoto(dni, votante) {
      fetch(`${SHEETDB_URL}/search?DNI=${dni}`)
        .then(response => response.json())
        .then(data => {
          if (data.length > 0) {
            document.getElementById('error-dni').textContent = 'Este DNI ya ha registrado un voto';
            document.getElementById('error-dni').style.display = 'block';
          } else {
            // Mostrar datos para confirmación
            mostrarConfirmacion(votante);
          }
        })
        .catch(error => {
          console.error('Error al verificar voto previo:', error);
          // Continuar aunque haya error de conexión
          mostrarConfirmacion(votante);
        });
    }

    function mostrarConfirmacion(votante) {
      votanteActual = votante;
      
      // Llenar información del votante
      const voterInfo = document.getElementById('voter-info');
      voterInfo.innerHTML = `
        <h3>DATOS DEL VOTANTE</h3>
        <p><strong>DNI:</strong> ${votante.dni}</p>
        <p><strong>Nombre:</strong> ${votante.nombre}</p>
        <p><strong>Registro:</strong> ${votante.registro}</p>
        <p><strong>Gerencia:</strong> ${votante.gerencia}</p>
        <p><strong>Cargo:</strong> ${votante.cargo}</p>
        <p><strong>Unidad:</strong> ${votante.unidad}</p>
      `;

      // Cambiar sección
      document.getElementById('dni-section').classList.remove('active');
      document.getElementById('confirmation-section').classList.add('active');
    }

    function confirmarDatos() {
      // Cambiar a sección de votación
      document.getElementById('confirmation-section').classList.remove('active');
      document.getElementById('candidates-section').classList.add('active');
    }

    function volverDNI() {
      // Volver a la sección de DNI
      document.getElementById('confirmation-section').classList.remove('active');
      document.getElementById('dni-section').classList.add('active');
      document.getElementById('dni').value = '';
      votanteActual = null;
    }

    function seleccionarCandidato(element, candidato) {
      // Quitar selección previa
      document.querySelectorAll('.candidate-item').forEach(item => {
        item.classList.remove('selected');
      });
      
      // Marcar nuevo candidato
      element.classList.add('selected');
      candidatoSeleccionado = candidato;
      
      // Mostrar botón votar
      document.getElementById('btn-votar').classList.add('show');
    }

    function enviarVoto() {
  if (!candidatoSeleccionado || !votanteActual) {
    alert('Error en el sistema. Por favor recargue la página.');
    return;
  }

  // Crear fecha en formato día/mes/año hora:minuto:segundo
  const now = new Date();
  const dia = now.getDate().toString().padStart(2, '0');
  const mes = (now.getMonth() + 1).toString().padStart(2, '0');
  const año = now.getFullYear();
  const hora = now.getHours().toString().padStart(2, '0');
  const minuto = now.getMinutes().toString().padStart(2, '0');
  const segundo = now.getSeconds().toString().padStart(2, '0');
  
  const fechaHora = `${dia}/${mes}/${año} ${hora}:${minuto}:${segundo}`;

  // DATOS CON REGISTRO INCLUIDO DESPUÉS DEL DNI
  const votoData = {
    "DNI": votanteActual.dni,
    "Registro": votanteActual.registro,  // ← AÑADIDO EL REGISTRO
    "Nombre Completo": votanteActual.nombre,
    "Fecha": fechaHora,
    "Elección": candidatoSeleccionado,
    "Unidad": votanteActual.unidad
  };

  // Mostrar loading
  document.getElementById('candidates-section').classList.remove('active');
  document.getElementById('loading').style.display = 'block';

  // Enviar a SheetDB
  fetch(SHEETDB_URL, {
    method: 'POST',
    headers: {
      'Accept': 'application/json',
      'Content-Type': 'application/json'
    },
    body: JSON.stringify(votoData)
  })
  .then(response => {
    if (!response.ok) {
      throw new Error(`Error HTTP: ${response.status}`);
    }
    return response.json();
  })
  .then(data => {
    document.getElementById('loading').innerHTML = '<strong style="color: green;">✓ ¡VOTO REGISTRADO EXITOSAMENTE!</strong><br><br>Gracias por participar en el proceso electoral.';
    setTimeout(() => {
      location.reload();
    }, 3000);
  })
  .catch(error => {
    console.error('Error:', error);
    document.getElementById('loading').innerHTML = '<strong style="color: red;">✗ Error al procesar el voto</strong><br><br>Por favor intente nuevamente.';
    setTimeout(() => {
      document.getElementById('candidates-section').classList.add('active');
      document.getElementById('loading').style.display = 'none';
    }, 2000);
  });
}
  </script>
</body>
</html>




